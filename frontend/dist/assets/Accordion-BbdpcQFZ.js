import{d as c,c as Y,r as l,U as H,g as ue,j as e,L as q,h as J,i as he,k as fe,l as K,u as xe,n as ge,I as Ce,o as ye,p as we,s as be,q as _e,v as je,w as Se}from"./index-BcVzZ_lP.js";import{D as X,a as ve}from"./discard-icon-BvSggSQ1.js";const ke=c.h3.withConfig({displayName:"CommentSectionstyled__CommentSectionTitle",componentId:"sc-m5p2as-0"})(["text-transform:uppercase;color:#333333;"]),Ie=c.div.withConfig({displayName:"CommentSectionstyled__CommentSectionWrapperOuter",componentId:"sc-m5p2as-1"})(["display:flex;flex-direction:column;"]),Ae=c.ul.withConfig({displayName:"CommentSectionstyled__CommentSectionWrapperInner",componentId:"sc-m5p2as-2"})(["padding-left:0px;margin-top:1.2rem;display:flex;flex-direction:column;gap:1.2rem;height:fit-content;max-height:600px;overflow-y:auto;overflow-x:auto;"]),Fe=c.form.withConfig({displayName:"CommentSectionstyled__FormWrapper",componentId:"sc-m5p2as-3"})(["display:flex;flex-direction:column;align-items:flex-end;"]),Ne=c.textarea.withConfig({displayName:"CommentSectionstyled__FormTextArea",componentId:"sc-m5p2as-4"})(["min-width:200px;min-height:130px;max-height:200px;max-width:600px;height:clamp(100px,6vw,250px);width:30vw;margin-top:1.2rem;padding:10px;"]),Re=c.button.withConfig({displayName:"CommentSectionstyled__FormButton",componentId:"sc-m5p2as-5"})(["margin-top:1.2rem;width:fit-content;padding:8px 16px;border-radius:4px;border:none;text-transform:uppercase;transition:all 150ms ease;font-weight:bold;letter-spacing:0.25px;height:fit-content;&:hover{cursor:pointer;background-color:darkgray;color:white;}"]);c.div.withConfig({displayName:"CommentSectionstyled__CommentContentWrapper",componentId:"sc-m5p2as-6"})(["padding:0.8rem;"]);c.div.withConfig({displayName:"CommentSectionstyled__CommentButtonsWrapper",componentId:"sc-m5p2as-7"})(["display:flex;gap:1.2rem;"]);const De=c.button.withConfig({displayName:"CommentSectionstyled__SeeMoreButton",componentId:"sc-m5p2as-8"})(["margin-top:0.5rem;background:none;border:none;color:blue;cursor:pointer;text-decoration:underline;&:hover{color:darkblue;}"]),We=c.div.withConfig({displayName:"CommentSectionstyled__CommentTextareaWrapper",componentId:"sc-m5p2as-9"})(["width:100%;display:flex;justify-content:flex-end;align-items:center;padding:20px;"]),Ee=c.div.withConfig({displayName:"CommentSectionstyled__ProfilePictureWrapper",componentId:"sc-m5p2as-10"})(["padding-right:20px;img{margin-top:-30px;}"]),Be=c.div.withConfig({displayName:"CommentSectionstyled__RepliesWrapper",componentId:"sc-m5p2as-11"})(["margin-left:2rem;margin-top:0.5rem;"]),Pe=c.div.withConfig({shouldForwardProp:t=>t!=="isreply"}).withConfig({displayName:"Commentstyled__CommentWrapper",componentId:"sc-192mxaw-0"})(["display:flex;align-items:flex-start;padding:1rem 0;border-bottom:1px solid #ddd;flex-direction:row;position:relative;",""],({isreply:t})=>t&&`
    &:last-child {
      border-bottom: none;
    }

    &:before {
    content: '';
    position: absolute;
    left: -4.8rem;
    top: 0;
    bottom: 0;
    width: 2px;
    background-color: #ddd;
    }
  `),Me=c.div.withConfig({displayName:"Commentstyled__ProfilePictureWrapper",componentId:"sc-192mxaw-1"})(["display:flex;flex-direction:column;align-items:center;margin-right:1rem;"]),Te=c.p.withConfig({displayName:"Commentstyled__Username",componentId:"sc-192mxaw-2"})(["margin-top:0.5rem;font-size:0.875rem;text-align:center;color:#333;"]),Le=c.div.withConfig({displayName:"Commentstyled__CommentItem",componentId:"sc-192mxaw-3"})(["flex:1;display:flex;flex-direction:column;justify-content:flex-start;align-items:flex-start;"]),$e=c.div.withConfig({displayName:"Commentstyled__CommentContentWrapper",componentId:"sc-192mxaw-4"})(["font-size:1rem;color:#333;margin-bottom:0.5rem;width:100%;"]),Q=c.div.withConfig({displayName:"Commentstyled__CommentActions",componentId:"sc-192mxaw-5"})(["display:flex;justify-content:flex-end;gap:0.5rem;"]),Ue=c.div.withConfig({displayName:"Commentstyled__LikesWrapper",componentId:"sc-192mxaw-6"})(["display:flex;align-items:center;margin-top:0.4rem;img{width:25px;cursor:pointer;margin-right:0.5rem;}"]),Z=c.textarea.withConfig({displayName:"Commentstyled__FormTextArea",componentId:"sc-192mxaw-7"})(["width:100%;min-height:100px;padding:0.5rem;margin-bottom:0.5rem;font-size:1rem;border-radius:4px;border:1px solid #ccc;"]),ze=c.div.withConfig({displayName:"Commentstyled__ReplyFormWrapper",componentId:"sc-192mxaw-8"})(["display:flex;flex-direction:column;margin-top:0.5rem;"]),I=c.button.withConfig({displayName:"Commentstyled__FormButton",componentId:"sc-192mxaw-9"})(["border-radius:4px;background:",";padding:",";color:#fff;border:none;height:40px;cursor:pointer;transition:all 150ms ease;&:hover{filter:brightness(0.8);}img{margin-top:1.2rem;width:25px;}"],({variant:t})=>t==="submit"?`${Y.secondary}`:t==="edit"?`${Y.primary}`:"none",({variant:t})=>t==="submit"||t==="edit"?"8px":"none"),Ve=c.button.withConfig({displayName:"Commentstyled__TrashBinButton",componentId:"sc-192mxaw-10"})(["padding:0.4rem 1rem;border-radius:4px;background:none;color:#fff;border:none;height:40px;cursor:pointer;display:flex;align-items:center;justify-content:center;background-image:url(",");background-repeat:no-repeat;background-position:center;background-size:20px 20px;transition:150ms ease;&:hover{filter:brightness(0.8);}"],X),Oe="/assets/like-1-CNs_ZtpD.png",Ye="/assets/like-2-Bksg747Q.png",qe="/assets/edit-icon-C9UsieMx.png",Qe="/assets/reply-icon-DzEBfRcY.png",Ze=({comment:t,isLiked:o,isEditing:n,editedComment:s,handleEditChange:r,onEdit:d,onDelete:C,onSave:w,onCancelEdit:y,isReply:h,children:f,onReplySubmit:b,...u})=>{const{profile:p}=l.useContext(H)||{},[_,j]=l.useState(o),[A,R]=l.useState(t.likes),[D,F]=l.useState(!1),[v,W]=l.useState(""),E=ue();l.useEffect(()=>{j(o)},[o,p==null?void 0:p.id]);const M=async()=>{try{const g=await he(t.id);R(g),j(L=>!L)}catch(g){console.error("Failed to toggle like",g)}},B=p&&Number(p==null?void 0:p.id)===t.user_id,T=()=>{Number(p==null?void 0:p.id)===t.user_id?E("/my-account"):E(`/user/${t.user_id}`)},P=async()=>{if(v.trim()!=="")try{await b(t.id,v),W(""),F(!1)}catch(g){console.error("Failed to submit reply",g)}};return e.jsxs(Pe,{isreply:h,...u,children:[e.jsxs(Me,{onClick:T,children:[e.jsx(q,{to:`/user/${t.user_id}`,children:e.jsx(J,{src:t.profile_picture,alt:t.user_name||"Username",width:"60px",border:"none",bg:"black"})}),e.jsx(q,{to:`/user/${t.user_id}`,children:e.jsx(Te,{children:t.user_name||"Username"})})]}),e.jsxs(Le,{children:[e.jsx($e,{children:n?e.jsxs(e.Fragment,{children:[e.jsx(Z,{value:s,onChange:r}),e.jsxs(Q,{children:[e.jsx(I,{onClick:()=>w(t.id,s),variant:"edit",children:"Save"}),e.jsx(I,{onClick:y,variant:"edit",children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:t.content}),e.jsxs(Ue,{children:[e.jsx("img",{src:_?Ye:Oe,alt:"like icon",onClick:M}),A]})]})}),e.jsxs(Q,{children:[!n&&B&&e.jsxs(e.Fragment,{children:[e.jsx(I,{onClick:d,children:e.jsx("img",{src:qe,alt:"Edit",title:"Edit"})}),e.jsx(I,{onClick:C,children:e.jsx("img",{src:X,alt:"Delete",title:"Delete"})})]}),!n&&!B&&!D&&p&&e.jsx(I,{onClick:()=>F(!0),children:e.jsx("img",{src:Qe,alt:"Reply",title:"Reply"})}),D&&e.jsxs(ze,{children:[e.jsx(Z,{value:v,onChange:g=>W(g.target.value),placeholder:"Write a reply..."}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"0.5rem"},children:[e.jsx(I,{onClick:P,variant:"submit",children:"Submit Reply"}),e.jsx(Ve,{onClick:()=>F(!1)})]})]})]}),Array.isArray(f)&&f[1]!==0&&e.jsx("div",{style:{width:"100%"},children:f})]})]})},Ge=(t,o)=>{const[n,s]=l.useState(!1),[r,d]=l.useState(null);return{showDeleteModal:n,handleDelete:h=>{s(!0),d(h)},confirmDelete:async()=>{if(r!==null)try{await fe(r),t(h=>{const f=(b,u)=>b.filter(p=>p.id!==u).map(p=>({...p,replies:f(p.replies||[],u)}));return f(h,r)}),s(!1),d(null)}catch(h){console.error("Failed to delete comment:",h),o("Failed to delete comment")}},cancelDelete:()=>{s(!1),d(null)}}},ee=(t,o)=>t.map(n=>n.id===o.parent_comment_id?{...n,replies:[...n.replies||[],o]}:n.replies&&n.replies.length>0?{...n,replies:ee(n.replies,o)}:n),te=(t,o,n)=>t.map(s=>{const r=s.replies||[];if(s.id===o){const d=[...r.filter(C=>!n.some(w=>w.id===C.id)),...n];return{...s,replies:d}}return r.length>0?{...s,replies:te(r,o,n)}:s}),U=(t,o,n)=>t.id===o?{...t,content:n}:t.replies&&t.replies.length>0?{...t,replies:t.replies.map(s=>U(s,o,n))}:t,ne=(t,o)=>{for(const n of t){if(n.id===o)return n;if(n.replies&&n.replies.length>0){const s=ne(n.replies,o);if(s)return s}}return null},He=(t,o,n)=>{const[s,r]=l.useState(!1);l.useEffect(()=>{if(t&&o.length>0&&!n&&!s){const d=document.getElementById(`comment-${t}`);d&&(d.scrollIntoView({behavior:"smooth"}),r(!0))}},[t,o,n,s])},Je=({contentId:t,contentType:o,page:n,commentId:s,TOP_LEVEL_BATCH_SIZE:r,comments:d,loadingTargetComment:C,setComments:w,setHasMore:y,setPage:h,setLoadingTargetComment:f})=>{l.useEffect(()=>{C&&(async()=>{try{const{comments:u,hasMore:p}=await K(o,t,n,r);if(w(_=>[..._,...u.filter(j=>!_.some(A=>A.id===j.id))]),y(p),s){const _=document.getElementById(`comment-${s}`);_||!p?(_||console.warn("Target comment not found in loaded comments but no more comments to fetch."),f(!1)):p&&h(j=>j+1)}else f(!1)}catch(u){console.error("Failed to fetch comments:",u)}})()},[t,o,n,s,d,C,w,y,h,f,r])},Ke=({contentId:t,contentType:o,page:n,TOP_LEVEL_BATCH_SIZE:s,setComments:r,setHasMore:d,setError:C})=>{l.useEffect(()=>{(async()=>{try{const{comments:y,hasMore:h}=await K(o,t,n,s);r(f=>[...f,...y.filter(b=>!f.some(u=>u.id===b.id))]),d(h)}catch(y){console.error("Failed to fetch comments:",y),C("Failed to fetch comments")}})()},[t,o,n,r,d,C,s])},G=5,Xe=3,it=({contentId:t,contentType:o,commentId:n})=>{const[s,r]=l.useState([]),[d,C]=l.useState(""),[w,y]=l.useState(null),[h,f]=l.useState(""),[b,u]=l.useState(null),{profile:p}=l.useContext(H)||{},[_,j]=l.useState(1),[A,R]=l.useState(!0),[D,F]=l.useState({}),[v,W]=l.useState(!0),{showDeleteModal:E,handleDelete:M,confirmDelete:B,cancelDelete:T}=Ge(r,u),{commentId:P}=xe(),g=P?parseInt(P,10):n,[L,oe]=l.useState(null),[se,re]=l.useState(!0),[ie,ae]=l.useState({});Je({contentId:t,contentType:o,page:_,commentId:g,TOP_LEVEL_BATCH_SIZE:G,comments:s,loadingTargetComment:v,setComments:r,setHasMore:R,setPage:j,setLoadingTargetComment:W}),Ke({contentId:t,contentType:o,page:_,TOP_LEVEL_BATCH_SIZE:G,setComments:r,setHasMore:R,setError:u});const z=(a,m=5,x=300)=>{const i=document.getElementById(a);i?i.scrollIntoView({behavior:"smooth"}):m>0&&setTimeout(()=>{z(a,m-1,x)},x)};l.useEffect(()=>{if(!g)return;(async()=>{try{const[,m]=await we(Number(g));oe(m.id),m.id!==g&&await V(m.id,()=>{z(`comment-${g}`,10,300)}),re(!1)}catch(m){console.error("Failed to load reply and parent comments:",m)}})()},[g]),He(L,s,se);const le=()=>{j(a=>a+1)},ce=async(a,m)=>{if(m.trim()!=="")try{const x=await je({content_id:t,content_type:o,content:m,parent_comment_id:a});r(i=>ee(i,x).map(S=>S.id===a?{...S,hasMoreReplies:!1,has_replies:!0}:S)),ae(i=>({...i,[a]:!0}))}catch(x){console.error("Failed to submit reply",x),u("Failed to submit reply")}},de=async a=>{if(a.preventDefault(),d.trim()===""){u("Comment cannot be empty");return}try{const m=await be(t,o,d);r(x=>[m,...x]),C(""),u(null)}catch(m){console.error("Fetch error:",m),u("Failed to submit comment")}},me=a=>{f(a.target.value),b&&u(null)},pe=async a=>{if(h.trim()===""){u("Comment cannot be empty");return}const m=ne(s,a);if(!m){u("Original comment not found.");return}r(x=>x.map(i=>U(i,a,h))),y(null),f(""),u(null);try{await Se(a,h)}catch(x){console.error("Failed to update comment:",x),u("Failed to update comment"),r(i=>i.map(k=>U(k,a,m.content)))}},V=async(a,m)=>{const x=D[a]||0;try{const{comments:i,hasMore:k}=await _e(a,o,t,Xe,x),S=Array.isArray(i)?i:[];r(N=>te(N,a,S)),F(N=>({...N,[a]:x+S.length})),k||r(N=>N.map($=>$.id===a?{...$,hasMoreReplies:!1}:$)),m&&m()}catch(i){console.error("Failed to fetch replies:",i)}},O=(a,m=!1,x)=>a.map((i,k)=>{const S=i.replies||[];return e.jsx("div",{id:`comment-${i.id}`,children:e.jsxs(Ze,{comment:i,isLiked:i.likedByUser??!1,isEditing:w===i.id,editedComment:h,onEdit:()=>{y(i.id),f(i.content)},onDelete:()=>M(i.id),onSave:pe,onCancelEdit:()=>y(null),isReply:m,onReplySubmit:ce,handleEditChange:me,children:[S.length>0&&e.jsx(Be,{children:O(S,!0,i.id)}),i.has_replies&&i.hasMoreReplies&&!ie[i.id]&&e.jsx(De,{onClick:()=>V(i.id),children:"See more replies"})]},m?`${x}-${k}`:i.id)},i.id)});return e.jsxs(e.Fragment,{children:[e.jsxs(Ie,{children:[e.jsx(ke,{children:"Comments"}),b&&e.jsx(ge,{message:b}),e.jsx(Ae,{id:"scrollableDiv",children:e.jsx(Ce,{dataLength:s.length,next:le,hasMore:A||v,loader:e.jsx(ye,{}),scrollableTarget:"scrollableDiv",children:O(s)})}),E&&e.jsx(ve,{onConfirm:B,onCancel:T,message:"Are you sure you want to delete this comment?"})]}),p&&e.jsxs(We,{children:[e.jsx(Ee,{children:e.jsx(J,{src:p.profile_picture||"",alt:"",width:"90px",border:"3px solid rgba(0,0,0,0.4)"})}),e.jsxs(Fe,{onSubmit:de,children:[e.jsx(Ne,{value:d,onChange:a=>C(a.target.value),placeholder:"Add comment..."}),e.jsx(Re,{type:"submit",children:"Add Comment"})]})]})]})},et=c.div.withConfig({displayName:"Accordionstyled__AccordionWrapper",componentId:"sc-k0890n-0"})(["margin:20px 0;"]),tt=c.div.withConfig({displayName:"Accordionstyled__AccordionItem",componentId:"sc-k0890n-1"})(["border:1px solid #ddd;margin-bottom:10px;"]),nt=c.div.withConfig({displayName:"Accordionstyled__AccordionTitle",componentId:"sc-k0890n-2"})(["background:#f5f5f5;padding:10px;cursor:pointer;"]),ot=c.div.withConfig({displayName:"Accordionstyled__AccordionContent",componentId:"sc-k0890n-3"})(["padding:10px;"]),at=({steps:t})=>{const[o,n]=l.useState([]),s=r=>{o.includes(r)?n(o.filter(d=>d!==r)):n([...o,r])};return e.jsx(et,{children:t.map((r,d)=>e.jsxs(tt,{children:[e.jsx(nt,{onClick:()=>s(d),children:r.title}),o.includes(d)&&e.jsx(ot,{children:e.jsx("div",{children:r.content})})]},d))})};export{at as A,it as C};
