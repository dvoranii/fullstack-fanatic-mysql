import{d as a,j as e,N as A,x as Q,r,O as V,U as q,H as K,Q as X,R as Y}from"./index-BcVzZ_lP.js";import{U as Z}from"./UserProfile-C2J9Jr72.js";const ee=a.div.withConfig({displayName:"UserAccountPagestyled__InboxImgWrapper",componentId:"sc-kajss3-0"})(["img{margin-right:0.4rem;}"]),te=a.div.withConfig({displayName:"UserAccountPagestyled__InboxWrapper",componentId:"sc-kajss3-1"})(["margin-bottom:0.4rem;margin-top:0.4rem;display:flex;align-items:center;gap:6px;a{display:flex;width:fit-content;}"]),oe=a.div.withConfig({displayName:"EditProfileModalstyled__ModalOverlay",componentId:"sc-9dibgy-0"})(["position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,0.5);display:flex;justify-content:center;align-items:center;z-index:1000;"]),ne=a.div.withConfig({displayName:"EditProfileModalstyled__ModalContent",componentId:"sc-9dibgy-1"})(["background-color:#fff;padding:20px;border-radius:8px;width:90%;max-width:500px;box-shadow:0 4px 8px rgba(0,0,0,0.1);position:relative;"]),ae=a.button.withConfig({displayName:"EditProfileModalstyled__CloseButton",componentId:"sc-9dibgy-2"})(["position:absolute;top:10px;right:10px;background:none;border:none;font-size:18px;cursor:pointer;&:hover{color:#888;}"]),ie=a.form.withConfig({displayName:"EditProfileModalstyled__ModalForm",componentId:"sc-9dibgy-3"})(["display:flex;flex-direction:column;gap:15px;"]),j=a.div.withConfig({displayName:"EditProfileModalstyled__FormGroup",componentId:"sc-9dibgy-4"})(["display:flex;flex-direction:column;"]),_=a.label.withConfig({displayName:"EditProfileModalstyled__Label",componentId:"sc-9dibgy-5"})(["font-size:14px;margin-bottom:5px;font-weight:bold;"]),k=a.input.withConfig({displayName:"EditProfileModalstyled__Input",componentId:"sc-9dibgy-6"})(["padding:8px;font-size:14px;border-radius:4px;border:1px solid #ccc;width:100%;"]),re=a.textarea.withConfig({displayName:"EditProfileModalstyled__TextArea",componentId:"sc-9dibgy-7"})(["padding:8px;font-size:14px;border-radius:4px;border:1px solid #ccc;resize:none;"]),se=a.button.withConfig({displayName:"EditProfileModalstyled__SaveButton",componentId:"sc-9dibgy-8"})(["background-color:#007bff;color:white;padding:10px 15px;border:none;border-radius:4px;font-size:16px;cursor:pointer;&:hover{background-color:#0056b3;}"]),S=a.p.withConfig({displayName:"EditProfileModalstyled__MaxCharCountText",componentId:"sc-9dibgy-9"})(["font-size:12px;text-align:right;margin-top:4px;"]),F=a.img.withConfig({displayName:"EditProfileModalstyled__ProfileImage",componentId:"sc-9dibgy-10"})(["width:100px;height:100px;object-fit:cover;margin-top:1.2rem;"]),le=a.div.withConfig({displayName:"SocialLinksEditorstyled__SocialLinkWrapper",componentId:"sc-1ec9jua-0"})(["display:flex;justify-content:space-between;align-items:center;margin-bottom:0.4rem;button{padding:2px 6px;height:fit-content;}"]),ce=a.button.withConfig({displayName:"SocialLinksEditorstyled__DeleteButton",componentId:"sc-1ec9jua-1"})(["border:none;border-radius:50%;margin-left:0.8rem;transition:all 150ms ease;&:hover{cursor:pointer;background-color:black;color:white;}"]),de=a.select.withConfig({displayName:"SocialLinksEditorstyled__SocialMenuDropdown",componentId:"sc-1ec9jua-2"})(["margin-top:1.2rem;padding:4px;&:hover{cursor:pointer;}"]),pe=({socialLinks:o,setSocialLinks:u,markSocialLinksChanged:d})=>{const h=t=>{u({...o,[t.target.name]:t.target.value}),d()},l=t=>{const p=t.target.value;o[p]||(u({...o,[p]:""}),d()),t.target.selectedIndex=0},c=async t=>{const p=await A();if(!p)throw new Error("User not authenticated");try{if(!(await fetch(`/api/profile/social-link/${t}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${p}`}})).ok)throw new Error("Failed to delete social link");const y={...o};delete y[t],u(y),d()}catch(m){console.error(m)}},b=["facebook","twitter","instagram","linkedin","youtube"].filter(t=>!o[t]);return e.jsxs(j,{children:[e.jsx(_,{children:"Social Links:"}),Object.keys(o).map(t=>e.jsxs(le,{children:[e.jsx(k,{type:"text",name:t,value:o[t],onChange:h,placeholder:`${t.charAt(0).toUpperCase()+t.slice(1)} URL`}),e.jsx(ce,{onClick:()=>c(t),children:"×"})]},t)),e.jsxs(de,{onChange:l,defaultValue:"",children:[e.jsx("option",{value:"",disabled:!0,children:"Add Social Link"}),b.map(t=>e.jsx("option",{value:t,children:t.charAt(0).toUpperCase()+t.slice(1)},t))]})]})},T=async(o,u)=>{const{data:d}=await Q(o,{method:"POST",body:u});return d},ue=({profile:o,setProfile:u,closeModal:d})=>{const[h,l]=r.useState(o.display_name||o.name||""),[c,b]=r.useState(o.profession||""),[t,p]=r.useState(o.bio||""),[m,y]=r.useState(o.social_links||{}),[g,s]=r.useState(null),[P,N]=r.useState(null),[M,U]=r.useState(null),E=30,D=50,I=250,[C,w]=r.useState({displayName:!1,profession:!1,bio:!1,socialLinks:!1,profilePicture:!1});r.useEffect(()=>{l(o.display_name||o.name||""),b(o.profession||""),p(o.bio||""),y(o.social_links||{}),N(o.profile_picture||null)},[o]);const z=i=>{l(i.target.value),w(n=>({...n,displayName:!0}))},O=i=>{b(i.target.value),w(n=>({...n,profession:!0}))},W=i=>{p(i.target.value),w(n=>({...n,bio:!0}))},$=i=>{y(i),w(n=>({...n,socialLinks:!0}))},R=i=>{var f;const n=(f=i==null?void 0:i.target.files)==null?void 0:f[0];if(!n)return;s(n),w(v=>({...v,profilePicture:!0}));const x=new FileReader;x.onload=()=>{U(x.result)},x.readAsDataURL(n)},H=()=>{w(i=>({...i,socialLinks:!0}))},G=async i=>{i.preventDefault();try{const n=await A();if(!n)throw new Error("User not authenticated");let x=o.profile_picture;if(C.profilePicture&&g){const L=new FormData;L.append("profile_picture",g);const B=await T("/api/profile/upload-profile-picture",L);if(!B.imagePath)throw new Error("Failed to upload profile picture");x=B.imagePath,N(x),U(null)}const f=new FormData;C.displayName&&f.append("display_name",h),C.profession&&f.append("profession",c),C.bio&&f.append("bio",t),C.socialLinks&&f.append("social_links",JSON.stringify(m)),x&&f.append("profile_picture",x);const v=await fetch("/api/profile/update-profile",{method:"PUT",headers:{Authorization:`Bearer ${n}`},body:f});if(!v.ok)throw new Error("Failed to update profile");const J=await v.json();u(J),alert("Profile updated successfully!"),d()}catch(n){console.error("Error updating profile:",n),alert("There was an error updating your profile.")}};return e.jsx(oe,{children:e.jsxs(ne,{children:[e.jsx(ae,{onClick:d,children:"×"}),e.jsxs(ie,{onSubmit:G,children:[e.jsxs(j,{children:[e.jsx(_,{children:"Profile Picture:"}),e.jsx(k,{type:"file",accept:"image/*",onChange:R}),M?e.jsx(F,{src:M,alt:"New Profile Preview"}):P&&e.jsx(F,{src:V(P),alt:"Profile Preview"})]}),e.jsxs(j,{children:[e.jsx(_,{children:"Display Name:"}),e.jsx(k,{type:"text",value:h,onChange:z,maxLength:E}),e.jsx(S,{style:{color:h.length>=E?"red":"black"},children:E-h.length})]}),e.jsxs(j,{children:[e.jsx(_,{children:"Profession:"}),e.jsx(k,{type:"text",value:c,onChange:O,maxLength:D}),e.jsx(S,{style:{color:c.length>=I?"red":"black"},children:D-c.length})]}),e.jsxs(j,{children:[e.jsx(_,{children:"Bio:"}),e.jsx(re,{value:t,onChange:W,maxLength:I,placeholder:"Enter your bio"}),e.jsx(S,{style:{color:t.length>=I?"red":"black"},children:I-t.length})]}),e.jsx(pe,{socialLinks:m,setSocialLinks:$,markSocialLinksChanged:H}),e.jsx(se,{type:"submit",children:"Save Changes"})]})]})})},he="/assets/inbox-DtmHC9lT.png",xe=()=>{const[o,u]=r.useState(null),[d,h]=r.useState(!1),{profile:l,setProfile:c,comments:b}=r.useContext(q)||{},[t,p]=r.useState(0);if(r.useEffect(()=>{(async()=>{try{const s=await Y();p(s)}catch(s){console.error("Failed to fetch unread conversations count:",s)}})()},[]),!l)return e.jsx("p",{children:"No user logged in"});const m=g=>{var P;const s=(P=g.target.files)==null?void 0:P[0];s&&u(s)},y=async()=>{if(o){const g=new FormData;g.append("bannerimage",o);try{const s=await T("/api/profile/upload-banner",g);s.imagePath&&c&&c({...l,banner_image:s.imagePath})}catch(s){console.error("Error uploading banner image: ",s)}}};return e.jsxs(e.Fragment,{children:[e.jsxs(K,{children:[e.jsx("title",{children:`${l.name}'s Account - Full Stack Fanatic`}),e.jsx("meta",{name:"description",content:`Manage your account settings, upload a banner, and view your inbox. Welcome, ${l.name}!`})]}),d&&c&&e.jsx(ue,{profile:l,setProfile:c,closeModal:()=>h(!1)}),e.jsx(Z,{profile:l,comments:b||[],isEditable:!0,isOwnProfile:!0,onEditProfileClick:()=>h(!0),onBannerChange:m,onBannerUpload:y,children:e.jsxs(te,{children:[e.jsxs("a",{href:"/my-account/inbox",children:[e.jsx(ee,{children:e.jsx("img",{src:he,alt:"Inbox Icon"})}),"Inbox"]}),e.jsx(X,{count:t})]})})]})};export{xe as default};
